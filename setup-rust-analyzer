#!/bin/sh

set -eux

# rustup component add rust-src

# target
release="${1:-2022-05-30}"
commit="${2:-f94fa62d6}"
toolchain="stable"
platform="x86_64-unknown-linux-gnu"

# repository
organization="rust-analyzer"
name="rust-analyzer"
repo_url="https://github.com/${organization}/${name}"
download_url="${repo_url}/releases/download/${release}/${name}-${platform}.gz"

location="$HOME/.atelier/bin"

curl -sL $download_url -o $location/$name.gz
gunzip $location/$name.gz

chmod +x $location/$name

set +x

version=$($location/$name --version)
echo "${version}"

# e.g. rust-analyzer f94fa62d6 2022-05-30 stable
if [ "${version}" != "${name} ${commit} ${release} ${toolchain}" ]; then
  echo "---> Something wrong :'("
  exit 2
fi

echo "---> Done"
